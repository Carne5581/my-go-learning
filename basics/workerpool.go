package main

import (
	"fmt"
	"math/rand"
	"sync"
	"time"
)

// 1. –°–¢–†–£–ö–¢–£–†–´ –î–ê–ù–ù–´–•
// –ó–∞–∫–∞–∑ (—Å—ã—Ä–∞—è –∑–∞–¥–∞—á–∞)
type Order struct {
	ID        int
	PizzaName string
}

// –ü–∏—Ü—Ü–∞ (–≥–æ—Ç–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
type Pizza struct {
	OrderID   int
	PizzaName string
	isCooked  bool
	ChefID    int // –ö—Ç–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª
}

// 2. –†–ê–ë–û–¢–ù–ò–ö (–í–û–†–ö–ï–†)
// –û–Ω –∫—Ä—É—Ç–∏—Ç—Å—è –≤–µ—á–Ω–æ, –ø–æ–∫–∞ –µ—Å—Ç—å —Ä–∞–±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ jobs
func chef(id int, jobs <-chan Order, results chan<- Pizza, wg *sync.WaitGroup) {
	// –ö–∞–∫ —Ç–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª jobs –∑–∞–∫—Ä–æ—é—Ç –∏ —Ä–∞–±–æ—Ç–∞ –∫–æ–Ω—á–∏—Ç—Å—è,
	// —Å—Ä–∞–±–æ—Ç–∞–µ—Ç defer –∏ –ø–æ–≤–∞—Ä —É–π–¥–µ—Ç –¥–æ–º–æ–π.
	defer wg.Done()

	fmt.Printf("üë®‚Äçüç≥ –ü–æ–≤–∞—Ä #%d: –í—ã—à–µ–ª –Ω–∞ —Å–º–µ–Ω—É!\n", id)

	// –ß–∏—Ç–∞–µ–º –∑–∞–¥–∞—á–∏ –∏–∑ –∫–∞–Ω–∞–ª–∞ (rande —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –æ—Ç–∫—Ä—ã—Ç)
	for order := range jobs {
		fmt.Printf("üë®‚Äçüç≥ –ü–æ–≤–∞—Ä #%d: –í–∑—è–ª –∑–∞–∫–∞–∑ #%d (%s)\n", id, order.ID, order.PizzaName)

		// –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã (–æ—Ç 1 –¥–æ 3 —Å–µ–∫—É–Ω–¥)
		processingTime := time.Duration(rand.Intn(3)+1) * time.Second
		time.Sleep(processingTime)

		// –ì–æ—Ç–æ–≤–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
		cookedPizza := Pizza{
			OrderID:   order.ID,
			PizzaName: order.PizzaName,
			isCooked:  true,
			ChefID:    id,
		}

		// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–æ—Ç–æ–≤—É—é –ø–∏—Ü—Ü—É –Ω–∞ –≤—ã–¥–∞—á—É
		results <- cookedPizza
	}

	fmt.Printf("üëã –ü–æ–≤–∞—Ä #%d: –°–º–µ–Ω–∞ –æ–∫–æ–Ω—á–µ–Ω–∞, —É—Ö–æ–∂—É.\n", id)
}

func main() {
	fmt.Println("=== PIZZA FACTORY V1.0 (WORKER POOL) ===")

	// –ù–∞—Å—Ç—Ä–æ–π–∫–∏
	const numJobs = 100   // –°–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤
	const numWorkers = 10 // –°–∫–æ–ª—å–∫–æ –ø–æ–≤–∞—Ä–æ–≤

	// 1. –ö–∞–Ω–∞–ª—ã
	// jobs - –æ—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤
	// results - –≥–æ—Ç–æ–≤–∞—è –µ–¥–∞
	jobs := make(chan Order, numJobs)
	results := make(chan Pizza, numJobs)

	// 2. WaitGroup (—á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, –∫–æ–≥–¥–∞ –ø–æ–≤–∞—Ä–∞ –∑–∞–∫–æ–Ω—á–∞—Ç)
	var wg sync.WaitGroup

	// 3. –ó–ê–ü–£–°–ö–ê–ï–ú –ü–û–í–ê–†–û–í (–í–æ—Ä–∫–µ—Ä–æ–≤)
	for w := 1; w <= numWorkers; w++ {
		wg.Add(1) // +1 –ø–æ–≤–∞—Ä
		go chef(w, jobs, results, &wg)
	}

	// 4. –ö–õ–ò–ï–ù–¢ –î–ï–õ–ê–ï–¢ –ó–ê–ö–ê–ó–´
	// –ö–∏–¥–∞–µ–º –∑–∞–¥–∞—á–∏ –≤ –∫–∞–Ω–∞–ª jobs
	menu := []string{"–ü–µ–ø–ø–µ—Ä–æ–Ω–∏", "–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", "4 –°—ã—Ä–∞", "–ì–∞–≤–∞–π—Å–∫–∞—è", "–ú—è—Å–Ω–∞—è"}

	for j := 1; j <= numJobs; j++ {
		order := Order{
			ID:        j,
			PizzaName: menu[rand.Intn(len(menu))],
		}
		jobs <- order // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —Ç—Ä—É–±—É
		fmt.Println("üì• –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç:", order.PizzaName)
	}

	// –í–ê–ñ–ù–û: –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–Ω–∞–ª –∑–∞–¥–∞—á.
	// –≠—Ç–æ —Å–∏–≥–Ω–∞–ª –ø–æ–≤–∞—Ä–∞–º: "–ó–∞–∫–∞–∑–æ–≤ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç, –¥–æ–¥–µ–ª—ã–≤–∞–π—Ç–µ —Ç–µ–∫—É—â–∏–µ –∏ —É—Ö–æ–¥–∏—Ç–µ".
	close(jobs)

	// 5. –ñ–î–ï–ú –ó–ê–í–ï–†–®–ï–ù–ò–Ø (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ)
	// –ü–æ—á–µ–º—É –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π? –ß—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∏–∂–µ.
	// –ï—Å–ª–∏ –∂–¥–∞—Ç—å –∑–¥–µ—Å—å (wg.Wait()), —Ç–æ –º—ã –∑–∞–±–ª–æ–∫–∏—Ä—É–µ–º —á—Ç–µ–Ω–∏–µ results, –∏ –∫–∞–Ω–∞–ª –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è.
	go func() {
		wg.Wait()      // –ñ–¥–µ–º, –ø–æ–∫–∞ –≤—Å–µ –ø–æ–≤–∞—Ä–∞ –∑–∞–∫–æ–Ω—á–∞—Ç
		close(results) // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–∞–Ω–∞–ª –≤—ã–¥–∞—á–∏, —Ç–∞–∫ –∫–∞–∫ –ø–∏—Ü—Ü—ã –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç
		fmt.Println("üõë –ö–£–•–ù–Ø –ó–ê–ö–†–´–¢–ê: –í—Å–µ –ø–æ–≤–∞—Ä–∞ —É—à–ª–∏.")

	}()

	// 6. –ó–ê–ë–ò–†–ê–ï–ú –ì–û–¢–û–í–´–ï –ó–ê–ö–ê–ó–´ (Main —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ö—É—Ä—å–µ—Ä)
	// –ß–∏—Ç–∞–µ–º –∏–∑ results, –ø–æ–∫–∞ –∫–∞–Ω–∞–ª –Ω–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è
	fmt.Println("\nüöÄ –ö–£–†–¨–ï–†: –ù–∞—á–∏–Ω–∞—é —Ä–∞–∑–≤–æ—Ä...")

	for pizza := range results {
		fmt.Printf("‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ: –ó–∞–∫–∞–∑: #%d (%s) -> –ü—Ä–∏–≥–æ—Ç–æ–≤–∏–ª –ü–æ–≤–∞—Ä #%d\n",
			pizza.OrderID, pizza.PizzaName, pizza.ChefID)
	}

	fmt.Println("üèÅ –°–º–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –í—Å–µ –∑–∞–∫–∞–∑—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.")
}
